<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Getting Started with HLVM</title>
  <link rel="stylesheet" href="hlvm.css" type="text/css">
</head>
<body>
<div class="title">Getting Started with the HLVM System</div>
<div class="warning">CAUTION: This document is a work in progress.</div>
<ol>
  <li><a href="#quickstart">Quick Start (For The Impatient)</a>
  <li><a href="#overview">Overview</a>
  <li><a href="#requirements">Requirements</a>
    <ol>
      <li><a href="#hardware">Hardware</a>
      <li><a href="#software">Software</a>
    </ol>
  </li>
  <li><a href="#other_packages">Building Other Packages</a></li>
  <li><a href="#building">Building HLVM With SCons</a></li>
</ol>

<div class="author">
  <p>Author:<a href="mailto:rspencer@reidspencer.com">Reid Spencer</a>.</p>
</div>

<!-- *********************************************************************** -->
<div class="section">
  <a name="quickstart"><b>Quick Start (For The Impatient)</b></a>
</div>
<!-- *********************************************************************** -->

<div class="text">
<p>Here's the quick start for getting up and running quickly with HLVM. Note
that this is for experts and the impatient only.</p>
<ol>
  <li>Read the documentation.</li>
  <li>Read the documentation.</li>
  <li>Remember that you were warned twice about reading the documentation.</li>
  <li>Obtain, build, and install the dependent packages. You need llvm, 
  llvm-gcc, apr, apr-util, libxml2, scons and gcc</li>
  <li>Obtain the HLVM Source Code (svn://hlvm.org/hlvm).</li>
  <li>Build hlvm with the "scons -Q" command.</li>
  <li>The configuration utility might ask you where your 3rd party software is
  located. Please enter the paths appropriately.</li>
  <li>Install hlvm with "scons -Q install prefix=/path/to/put/hlvm".</li>
</ol>
</div>

<!-- *********************************************************************** -->
<div class="section"><a name="overview"><b>Overview</b></a></div>
<!-- *********************************************************************** -->
<div class="text">
<p>Welcome to HLVM! This document shows you how to get started with the High
Level Virtual Machine. Before you do that, lets get some questions answered up
front to make sure you actually want to get started with HLVM.</p>
<dl>
  <dt>What is HLVM?</dt>
  <dd>HLVM is a toolkit for building virtual machines for dynamic languages. Its
  not something everyone is going to want to mess with. Generally, it is highly
  technical and doesn't really do much for an end user. On the other hand, if
  you're developing your own dynamic programming language, HLVM is <em>just</em>
  the ticket.</dd>
  <dt>Who uses HLVM?</dt>
  <dd>Generally, programming language researchers and software tool vendors 
  use HLVM.</dd>
  <dt>What does HLVM do?</dt>
  <dd>HLVM doesn't really <em>do</em> anything. While it provides a few
  executables, these are ancillary in nature. Most of HLVM's capabilities are
  provided through a set of code libraries that can be incorporated into other
  programs. HLVM does provide a virtual machine executable but without a program
  to run (one that has been compiled by HLVM based tools), the virtual machine
  won't do anything. So, if you're an end user of software, HLVM probably isn't
  for you. If you're a developer, however, we think you'll find HLVM quite
  spiffy.</dd>
  <dt>How hard is HLVM to build?</dt>
  <dd>Although we've tried to make building HLVM dead simple, it is a
  complicated system and you must understand some of those complexities to get
  it right. One of its major complexities is that it incorporates many other
  packages that are not distributed with HLVM. You must build and install those
  packages yourself.</dd>
</dl>
<p>Okay, if you're still interested in HLVM, then we have a few more
introductory things to cover:</p>
<ol>
  <li>HLVM provides a suite of libraries and a few tools. These are statically
  linked (archive files and object files) so that you can incorporate the
  appropriate pieces into your project. This was done purposefully since we
  don't believe that creating a monolithic shared library (DLL) is particularly
  useful. This architecture gives you the freedom to construct your own
  libraries by picking the appropriate things from the palette that HLVM offers.
  </li>
  <li>Although HLVM provides several tools, these are ancillary in nature. They
  are provided to help either with testing HLVM or to help you use HLVM. The
  <tt>hlvm</tt> program (the actual virtual machine) is a reference
  implementation. You may choose to implement it differently (with the help of
  HLVM's runtime libraries, of course).</li>
</ol>
</div>

<!-- *********************************************************************** -->
<div class="section"><a name="requirements"><b>Requirements</b></a></div>
<!-- *********************************************************************** -->

<div class="text">

  <p>Before you attempt to build HLVM, you need to understand its requirements.
  HLVM is non-trivial and depends on a number of other software packages. These
  packages will be required before you can build HLVM. Taking
  a moment to familiarize yourself with HLVM's requirements may save you some 
  time in the long run.<p>
  <p>The table below shows the software that HLVM depends on. You <b>must</b> 
  obtain and build these packages yourself if they are not already present on 
  your system. HLVM won't compile or run without them.</p>
</div>

<!-- ======================================================================= -->
<div class="subsection"><a name="hardware"><b>Hardware</b></a></div>
<div class="text">
  <p>HLVM supports whatever hardware LLVM supports. For details, please see
  <a href="http://llvm.org/docs/GettingStarted.html#hardware">LLVM's documentation</a></p>
</div>

<!-- ======================================================================= -->
<div class="subsection"><a name="software"><b>Software</b></a></div>
<div class="text">
  <p>Compiling HLVM requires that you have several software packages installed. 
  The table below lists those required packages. The Package column is the usual
  name for the software package that HLVM depends on. The Version column 
  provides "known to work" versions of the package. The Notes column describes 
  how HLVM uses the package and provides other details.</p>
  <table>
    <tr><th>Package</th><th>Version</th><th>Notes</th></tr>
    <tr>
      <td><a href="http://llvm.org/">llvm</a></td>
      <td>1.8cvs<a href="#sf2"><sup>2</sup></a></td>
      <td>Low Level Virtual Machine. This compler infrastructure provides the
        low level code generation and optimization, linking, bytecode, JIT,
        and other facilities HLVM needs.  LLVM is HLVM's sister project. 
        It handles all the low level details for HLVM.</td>
    </tr>
    <tr>
      <td><a href="http://llvm.org/">llvm-gcc4</a></td>
      <td>4</a></td>
    <td>LLVM C/C++ Frontend, Version 4. This is a full GCC (Gnu Compiler 
      Collection) compiler but with extensions for generating code via LLVM 
      instead of GCC's normal RTL-based backend. This tool can compile C, C++,
      Objective-C and Objective-C++ languages into either native binary or
      LLVM bytecode. In either case, it utilizes LLVM's suite of passes for code
      optimization.</td>
    </tr>
    <tr>
      <td><a href="http://apr.apache.org/">apr</a></td>
      <td>1.2.7</td>
      <td>Apache Portable Runtime. APR is used as the portability layer to
        abstract away differences between the various operating systems that
        HLVM runs on. This simplifies the HLVM Runtime library implementation
        and also endows it with some robustness. It handles various OS 
        abstraction such as file I/O, threading, locking, loading, etc.</td>
    </tr>
    <tr>
      <td><a href="http://apr.apache.org/">apr-util</a></td>
      <td>1.2.7</td>
      <td>Apache Portable Runtime Utilities. Additional runtime utilities.</td>
    </tr>
    <tr>
      <td><a href="http://xmlsoft.org/downloads.html">libxml2</a></td>
      <td>2.6.24</td>
      <td>XML parsing and validation toolkit.</td>
    </tr>
    <tr>
      <td><a href="http://www.gnu.org/software/gperf/">gperf</a></td>
      <td>2.7.2 (3.0.1 won't work)</td>
      <td>GNU Perfect Hash Function Generator, used for recognizing element
      and attribute names in XML documents.</td>
    </tr>
    <tr>
      <td><a href="http://gcc.gnu.org">gcc</a></td>
      <td>&ge;3.4.4</td>
      <td>C/C++ compiler for compiling HLVM</td>
    </tr>
    <tr>
      <td><a href="http://subversion.tigris.org/">subversion</a></td>
      <td>&ge;1.1</td>
      <td>Suversion access to HLVM source repository.</td>
    </tr>
    <tr>
      <td><a href="http://scons.org/download.php">scons</a></td>
      <td>0.96.92</td>
      <td>Software Construction system used for HLVM's build system.</td>
    </tr>
    <tr>
      <td><a href="http://python.org/">python</a></td>
      <td>2.3</td>
      <td>Python programming language, required by scons</td>
    </tr>
    <tr>
      <td><a href="http://savannah.gnu.org/projects/dejagnu">dejagnu</a></td>
      <td>1.4.2</td>
      <td>Automated test suite<sup><a href="#sf1">1</a></sup></td>
    </tr>
    <tr>
      <td><a href="http://www.tcl.tk/software/tcltk/">tcl</a></td>
      <td>8.3, 8.4</td>
      <td>Automated test suite<sup><a href="#sf1">1</a></sup></td>
    </tr>
    <tr>
      <td><a href="http://expect.nist.gov/">expect</a></td>
      <td>5.38.0</td>
      <td>Automated test suite<sup><a href="#sf1">1</a></sup></td>
    </tr>
    <tr>
      <td><a href="http://www.stack.nl/~dimitri/doxygen/">doxygen</a></td>
      <td>&ge;1.4.4<a href="#sf3"><sup>3</sup></a></td>
      <td>C/C++ automated documentation generator</td>
    </tr>
    <tr>
      <td><a href="http://xmlsoft.org/XSLT/xsltproc2.html">xsltproc</a></td>
      <td>&ge;2.6.24<a href="#sf3"><sup>3</sup></a></td>
      <td>XSLT Processor (comes with libxml2)</td>
    </tr>
  </table>

  <p><b>Notes:</b></p>
  <div class="notes">
  <ol>
    <li><a name="sf1">Only needed if you want to run the automated test 
      suite in the <tt>hlvm/test</tt> directory.</a></li>
    <li><a name="sf2">Certain LLVM tools are being modified to accommodate HLVM
      as it progresses. Until this development slows you are urged to obtain
      LLVM from the CVS sources and keep it up to date.</a></li>
    <li><a name="sf3">You only need this tool if you intend to build the 
      documentation.</a></li>
  </ol>
  </div>
  
  <p>Additionally, your compilation host is expected to have the usual Unix 
  utilities, specifically:</p>
  <ul>
    <li><b>ar</b> - archive library builder</li>
    <li><b>gzip*</b> - gzip command for distribution generation</li>
    <li><b>gunzip*</b> - gunzip command for distribution checking</li>
    <li><b>ranlib</b> - symbol table builder for archive libraries</li>
    <li><b>tar</b> - tape archive for distribution generation</li>
  </ul>
</div>

<!-- *********************************************************************** -->
<div class="section"><a name="other_packages">Building Other Packages</a></div>
<!-- *********************************************************************** -->
<div class="text">
  <h2>Separate Install Area</h2>
  <p>It is suggested that you keep a separate installation area for building the
  things that HLVM depends upon. This is the location in your file system where
  you will install the built packages. It is used with the <tt>--prefix</tt>
  option to the configure programs of the packages. By using a separate install
  area, you ensure that the HLVM version of required packages doesn't interfere
  with any of your system installed packages.</p>
  <h2>libxml2</h2>
  <ul>
    <li>Always build libxml2 first. It doesn't depend on much else</li>
    <li>Use version 2.6.24 or later</li>
  </ul>
  <h2>apr</h2>
  <ul>
    <li>Optionally use the <tt>--enable-debug</tt> configure flag.</li>
    <li>Required to use the <tt>--enable-threads</tt> configure flag.</li>
    <li>Required to use the <tt>--enable-other-child</tt> configure flag.</li>
  </ul>
  <h2>apr-util</h2>
  <p>No special instructions.</p>
  <h2>llvm</h2>
  <ul>
    <li>You <em>must</em> use the latest CVS version of LLVM. LLVM is HLVM's 
    sister project and the two are intricately connected. Consequently, patches
    are made to LLVM in order to satisfy HLVM's requirements. At some point,
    this restriction will be lifted as a released version of LLVM will contain
    all of HLVM's requirements. However, while in development you should
    checkout the latest version of LLVM and keep it up to date.</li>
    <li>Configure LLVM with --prefix=/path/to/install/llvm</li>
    <li>Build LLVM with "make tools-only". You don't need the runtime library
    because we will be using llvm-gcc4</li>
  </ul>
  <h2>llvm-gcc</h2>
  <ul>
    <li>You <em>must</em> use version for of llvm-gcc, not version 3.</li>
    <li>Obtain llvm-gcc4 source from 
    <a href="http://nondot.org/sabre/2006-06-01-llvm-gcc-4.tar.gz">
      http://nondot.org/sabre/2006-06-01-llvm-gcc-4.tar.gz</a></li>
    <li>Alternatively, you can obtain a binary version of llvm-gcc4 for
    Linux (Fedora Core 3) from
    <a href="http://llvm.org/2006-06-01-llvm-gcc4-linux-x86-binary.tar.gz">
      http://llvm.org/2006-06-01-llvm-gcc4-linux-x86-binary.tar.gz</a></li>
    <li>You <em>must</em> install llvm-gcc4 into an installation area that
    is not used by any other software, particularly gcc. This is required
    because you might clobber your compiler's runtime libraries and tools
    otherwise.</li>
    <li>See the <tt>README.llvm</tt> in the top of the llvm-gcc4 source bundel
    if you're inclined to build llvm-gcc4 on your own. It isn't hard but there
    are a few things you need to do correctly.</li>
  </ul>
</div>
<!-- *********************************************************************** -->
<div class="section"><a name="building">Building HLVM With SCons</a></div>
<!-- *********************************************************************** -->
<div class="text">
  <p>HLVM uses the SCons tool for software construction. While <tt>make</tt> 
  and the various <tt>auto*</tt> tools were originally used, the full
  programming language support (Python) of SCons was attractive because of the
  platform support and the need to do intricate things to build HLVM. If you
  are not familiar with SCons, we recommend you take a quick peek at the
  <a href="http://www.scons.org/doc/0.96.92/HTML/scons-user.html">SCons User 
    Manual</a>. While an in depth knowledge is not needed to build HLVM, having
  some understanding of scons will definitely help.</p>
  <p>The details on using scons for HLVM can be found in the 
  <a href="DevelopersGuide.html">Developer's Guide</a>, but here's a precis to
  help you get started:</p>
  <ul>
    <li>You can still use <tt>make</tt> as the <tt>Makefile</tt> in the top
    level has the customary targets that will invoke the corresponding
    <tt>scons</tt> command.</li>
    <li>HLVM uses a number of customizations to the facilities provided in order
    to keep the SConstruct and SConscript files minimized. These facilities are
    provided in a Python module named <tt>build</tt> at the root directory. This
    departure was necessary in order to hide the implementation details of many
    of the build rules and configuration details that HLVM requires.</li>
    <li>An important thing to know is that configuration is done on every build.
    However, if the dependencies haven't changed, the result is cached and this
    runs quite quickly. This is a huge help to the project because it
    automatically detects environment changes and reconfigures HLVM accordingly
    which saves time and also catches problems very early.</li>
    <li>There are numerous configuration options available. You should use the
    <tt>scons -Q --help</tt> option to get a description of all of them.</li>
    <li>Configuration options are saved in cache files so you don't have to keep
    repeating them on each invocation of <tt>scons</tt></li>
    <li>The important options to use are:
    <ul>
      <li><em>-Q</em>. Normally scons is quite verbose about all the
      configuration checks it is doing. This option just tells scons to be quiet
      about such things.</li>
      <li><em>--prefx=/path/to/install/dir</em>. This option tells the build
      system where HLVM should be installed. The default is <tt>/usr/local</tt>.
      </li>
      <li><em>confpath=&lt;path&gt;</em>. This option provides a colon (:)
      separated list of paths to search when configuring HLVM. This is handy if
      you normally install your software in an unusual place. For example, some
      of our developers install software to <tt>/proj/install</tt> or 
      <tt>/more/install</tt>. By using this option, the configuration code will
      search the paths for the packages and tools that it is looking for.
      Furthermore, it will give priority to the <tt>confpath</tt> paths over the
      regular places that it looks.</li>
      <li><em>mode=&lt;mode_name&gt;</em>. This gives a name to your
      configuration. You can replace <tt>&lt;mode_name&gt;</tt> with any name
      you like.  For example you might think of your configuration as
      "debug" or "optimized". When you name a configuration this way, your
      configuration parameters will be saved in a file named
      <tt>.&lt;mode_name&gt;_options</tt>. To repeat the options specified the
      first time, simply issue the command <tt>scons mode=&lt;mode_name&gt;</tt>
      and all your configuration options will be read from the cache file.</li>
      <li><em>debug=0|1</em>. This turns debug mode on and off. Debug mode
      causes the compiler to emit debug symbols and turns on the HLVM_DEBUG
      pre-processor symbol so that debug code can be included.</li>
      <li><em>assertions=0|1</em>. This turns assertions on or off. This is
      separate from debug because we might want to have a release or optimized
      version that includes assertions but not debug code.</li>
      <li><em>inline=0|1</em>. This controls whether the compiler should emit
      inline functions as real functions or attempt to inline them. When
      building a version you intend to debug with <tt>gdb</tt>, it is often
      handy to turn this off. You pay a performance penalty but it is also much
      easier to debug the code.</li>
      <li><em>optimize</em>. This option tells the compiler to optimize the
      generated code. This may make it difficult to debug the resulting program.
      However, it will also make the program run much faster.</li>
      <li><em>with_*</em>. There are a variety of options that are prefixed with
      <tt>with_</tt>, for example <tt>with_llvm</tt> or <tt>with_apr</tt>. Thise
      options allow you to tell scons where a specific package is located on
      your system. See the <tt>scons -Q --help</tt> output for a full list of
      these options.</li>
    </ul></li>
    <li>The default target will simply build all the libraries and tools.</li>
    <li>There are additional pseudo-targets (<i>aliases</i> in SCons lingo) that
    you can build:
    <ul>
      <li><em>check</em>. This will run the Deja-Gnu test suite located in the
      <tt>test</tt> directory. If you're making changes to HLVM, it is handy to
      run this frequently to ensure that you haven't caused any regressions.
      Patches that do not pass this test suite will not be accepted.</li>
      <li><em>install</em>. This alias will install the HLVM header files,
      libraries, tools and documentation to the install directory (which was
      specified with the <tt>--prefix=</tt> configuration option).</li>
      <li><em>docs</em>. By default, documentation is not built because it is
      time consuming and not necessary for each build. When this alias is used,
      the doxygen and XSLT generated documentation will be built.</li>
    </ul></li>
  </ul>
</div>
</body>
</html>
